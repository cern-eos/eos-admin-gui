<div data-ng-controller="dashboardCtrl">

  <div class="row">

    <div class="panel">
      <div class="panel-heading border">
      <p>Space View</p>
      </div>
      
      <div class="panel-body">
        <div class="row mb25">
          <div class="pull-right" ng-controller="ModalDemoCtrl">
            <button class="btn btn-sm btn-info btn-icon mr5" ng-click="openDefineSpaceModal()">
              <i class="fa fa-plus-circle"></i>
              <span>Define Space</span>
            </button>
          </div>
        </div>
  
        <!-- <table class="table table-bordered bordered table-striped table-condensed datatable" ui-jq="dataTable"> -->
        <div class="row">
          <div class="col-sm-9">
          </div>
          <div class="col-sm-3">
            <form class="form-inline pull-right">
              <div class="form-group ">
                  <input type="text" ng-model="search" class="form-control" placeholder="Search">
              </div>
            </form>
          </div>
        </div>
        <br>
        <table class="table table-bordered bordered table-striped table-condensed datatable">
          <thead>

            <tr>
              <th ng-click="sort('name')">Name
                  <span class="glyphicon sort-icon" ng-show="sortKey=='name'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
              </th>
              <th ng-click="sort('cfg.groupsize')">Groupsize
                  <span class="glyphicon sort-icon" ng-show="sortKey=='cfg.groupsize'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
              </th>
              <th ng-click="sort('cfg.groupmod')">Groupmod
                  <span class="glyphicon sort-icon" ng-show="sortKey=='cfg.groupmod'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
              </th>
              <th ng-click="sort('nofs')">N(fs)
                  <span class="glyphicon sort-icon" ng-show="sortKey=='nofs'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
              </th>
              <!-- N(fs-rw) -->
              <th ng-click="sort('dev.stat.statfs.filled')">sum(usedbytes)
                  <span class="glyphicon sort-icon" ng-show="sortKey=='dev.stat.statfs.filled'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
              </th>
              <th ng-click="sort('sum.stat.statfs.capacity')">sum(capacity)
                  <span class="glyphicon sort-icon" ng-show="sortKey=='sum.stat.statfs.capacity'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
              </th>
              <th ng-click="sort('sum.stat.statfs.capacity_rw')">capacity(rw)
                  <span class="glyphicon sort-icon" ng-show="sortKey=='sum.stat.statfs.capacity_rw'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
              </th>
              <th ng-click="sort('cfg.nominalsize')">nom.capacity
                  <span class="glyphicon sort-icon" ng-show="sortKey=='cfg.nominalsize'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
              </th>
              <th ng-click="sort('cfg.balancer.threshold')">threshold
                  <span class="glyphicon sort-icon" ng-show="sortKey=='cfg.balancer.threshold'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
              </th>
              </th>
                 <th align="center">Edit
              </th>  
              <!--               <th>ntx</th>
              <th>active</th>
              <th>intergroup</th> -->
            </tr>
          </thead>
         <tbody  ng-controller="ModalDemoCtrl">
            <tr dir-paginate="space in spaces|orderBy:sortKey:reverse|filter:search|itemsPerPage:10">
              <td>{{space.name}}</td>
              <td>{{space.cfg.groupsize}}</td>
              <td>{{space.cfg.groupmod}}</td>
              <td>{{space.nofs}}</td>
              <td>{{space.sum.stat.statfs.usedbytes | filesize:2}}</td>
              <td>{{space.sum.stat.statfs.capacity | filesize:2}}</td>
              <td>{{space.sum.stat.statfs.capacity_rw | filesize:2}}</td>
              <td>{{space.cfg.nominalsize}}</td>
              <td>{{space.cfg.balancer.threshold}}</td>
	      <td  align="center">
                <button class="btn btn-info  btn-xs" ng-click="openUpdateSpaceModal(space.name)">edit</button>
                <button class="btn btn-danger  btn-xs" ng-click="delSpace(space.name)">del</button>
              </td>

            </tr>
          </tbody>
        </table>
        <dir-pagination-controls max-size="3" direction-links="true" boundary-links="true" >
          </dir-pagination-controls>

        <!-- <div class="row">
          <div class="col-sm-9">
          </div>
          <div class="col-sm-3">
            
          </div>
        </div>    -->      
      </div>
    </div>

  </div>


<script type="text/ng-template" id="defineSpaceModal.html">

  <div class="modal-header">
    <h3 class="modal-title"> Define Space</h3>
  </div>
  <form class="form-horizontal bordered-group" ng-submit="addNewSpace()" role="form">
    <div class="modal-body">
      <div class="panel-body">
        <div class="form-group">
          <label class="col-sm-3 control-label">Space Name</label>
          <div class="col-sm-9">
            <input type="text" class="form-control" ng-model="formData.name" placeholder="{{formData.name}}" >
          </div>
        </div>
        <div class="form-group">
          <label class="col-sm-3 control-label"> Max Filesystems per Scheduling group</label>
          <div class="col-sm-9">
           <input type="number" min="0" class="form-control" ng-model="formData.groupsize" placeholder="{{formData.groupsize}}" >
          </div>
        </div>
          <div class="form-group">
          <label class="col-sm-3 control-label">Max Filesystems per Node</label>
          <div class="col-sm-9">
           <input type="number" min="0" class="form-control" ng-model="formData.groupmod" placeholder="{{formData.groupmod}}" >
          </div>
        </div>
    <div class="modal-footer">
      <input type="submit" class="btn btn-primary btn-sm" id="addNewSpace" value="Add" />
    </div>
  </form>
</script>

<script type="text/ng-template" id="updateSpaceModal.html">

 <div class="modal-header">
    <h3 class="modal-title">Update Filesystem </h3>
  </div>
  <form class="form-horizontal bordered-group" ng-submit="updateSpaceParams()" role="form">
    <div class="modal-body">
      <div class="panel-body">
        <div class="form-group">
          <label class="col-sm-3 control-label">Config Parameter</label>
          <div class="col-sm-9">
             <select class="form-control" ng-model="formData.key" placeholder="{{formData.key}}" ngRequired="true">
                 <option value="space.nominalsize">Nominal Size</option>
                 <option value="space.balancer">Balancer (on/off)</option>
                 <option value="space.balancer.threshold">Balancer Threshold (percent)</option> 
                 <option value="space.balancer.node.rate">Balancer Node Rate (MB/s)</option>
                 <option value="space.balancer.node.ntx">Balancer Node Number of Transactions</option>
                 <option value="space.converter">Converter (on/off)</option>
		 <option value="space.converter.ntx">Converter Number of Transactions</option>
		 <option value="space.drainer.node.rate">Drainer Node Rate (MB/s)</option>
                 <option value="space.drainer.node.ntx">Drainer Node Number of Transactions</option>
		 <option value="space.lru">LRU (on/off)</option>
                 <option value="space.lru.interval">LRU Interval (sec)</option>
                 <option value="space.headroom">Headroom (size)</option>
		 <option value="space.scaninterval">Scan Interval (sec)</option>
		 <option value="space.drainperiod">Drain Period (sec)</option>
	  	 <option value="space.graceperiod">Grace Period (sec)</option>
                 <option value="space.autorepair">Auto Repair (on/off)</option>
                 
             </select>
            <input type="hidden" class="form-control" ng-model="formData.name" value="{{formData.name}}"/>
          </div>
        </div>
	<div class="form-group">
          <label class="col-sm-3 control-label">value</label>
          <div class="col-sm-9">
            <input type="text" class="form-control" ng-model="formData.value" placeholder="{{formData.value}}">
          </div>
        </div>
     </div>
   </div>
   <div class="modal-footer">
      <input type="submit" class="btn btn-primary btn-sm" id="updateSpaceParams" value="Update" />
    </div>
  </form>

</script>
</div>
